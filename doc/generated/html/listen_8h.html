<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>screamer: listen.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>listen.h File Reference</h1>UDP logging program functions.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &quot;<a class="el" href="scream-common_8h-source.html">scream-common.h</a>&quot;</code><br>

<p>
<a href="listen_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structclient__record.html">client_record</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structclient__db.html">client_db</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#9ef2e9d6f4eba8699b87c9eb676344a7">CLIENT_MAX_NUM</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#766b55be6dacc759548a399b69d94e7a">TIME_TO_DEATH</a>&nbsp;&nbsp;&nbsp;100</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#485d31e84cd14a55c30dd89879f21b4f">DIE_AT_ANOTHER_TIME</a>&nbsp;&nbsp;&nbsp;(-1)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#8b91cffd770899bbced999f3e5ca1618">listener_handle_packet</a> (const struct sockaddr_in *client_addr, const <a class="el" href="structscream__packet__general.html">scream_packet_general</a> *packet, size_t len, int sock, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#ec133b4b155786027bc06e32e938fc42">register_client</a> (const struct sockaddr_in *client_addr, const <a class="el" href="structscream__packet__register.html">scream_packet_register</a> *packet, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#5596da7ea67727af7317a7567d277d1f">update_client_address</a> (const struct sockaddr_in *client_addr, const <a class="el" href="structscream__packet__update__address.html">scream_packet_update_address</a> *packet, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#dd5eb83a8c3d1c6d9517d50213477866">record_packet</a> (const struct sockaddr_in *client_addr, const <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> *packet, unsigned long long ts, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#a4b3466b7f80ac38d6a1203aa482cdf2">reset_client</a> (int sock, const struct sockaddr_in *client_addr, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#3f5926de726bb2ac22b4535e7e516061">send_result</a> (int sock, const struct sockaddr_in *client_addr, const struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#bee273c1a34fbc88f25d136ecd32efbe">send_return_routability_ack</a> (int sock, const struct sockaddr_in *dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#8c8b9471866ddf0ca122010265b71426">send_update_address_ack</a> (int sock, const struct sockaddr_in *dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#7596b6bd9e2d94203fe12fed9e9b4d31">mark_client_for_unregistering</a> (const struct sockaddr_in *client_addr, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#31ace544a99797205c9b246b73546cd8">unregister_client</a> (const struct sockaddr_in *client_addr, struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct <a class="el" href="structclient__record.html">client_record</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#9535115f68e8eb3bb7bff4914dceedc1">get_empty_slot</a> (const struct sockaddr_in *client_addr, const struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct <a class="el" href="structclient__record.html">client_record</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="listen_8h.html#fe0554ccbbd75254413e5e44b0afb851">get_client_record</a> (const struct sockaddr_in *addr, const struct <a class="el" href="structclient__db.html">client_db</a> *db)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
UDP logging program functions. 
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Tobias Heer &lt;<a href="mailto:heer@cs.rwth-aachen.de">heer@cs.rwth-aachen.de</a>&gt; <p>
Tadeus Prastowo &lt;<a href="mailto:eus@member.fsf.org">eus@member.fsf.org</a>&gt;</dd></dl>
This file provides the base functions for the UDP listener. <hr><h2>Define Documentation</h2>
<a class="anchor" name="9ef2e9d6f4eba8699b87c9eb676344a7"></a><!-- doxytag: member="listen.h::CLIENT_MAX_NUM" ref="9ef2e9d6f4eba8699b87c9eb676344a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLIENT_MAX_NUM&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The maximum number of clients that the listener can have. 
</div>
</div><p>
<a class="anchor" name="485d31e84cd14a55c30dd89879f21b4f"></a><!-- doxytag: member="listen.h::DIE_AT_ANOTHER_TIME" ref="485d31e84cd14a55c30dd89879f21b4f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIE_AT_ANOTHER_TIME&nbsp;&nbsp;&nbsp;(-1)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
An indication that a client record is still in use. 
</div>
</div><p>
<a class="anchor" name="766b55be6dacc759548a399b69d94e7a"></a><!-- doxytag: member="listen.h::TIME_TO_DEATH" ref="766b55be6dacc759548a399b69d94e7a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIME_TO_DEATH&nbsp;&nbsp;&nbsp;100          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The time in second after sending a <a class="el" href="structscream__packet__result.html">scream_packet_result</a> at which the client should be disassociated. 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="fe0554ccbbd75254413e5e44b0afb851"></a><!-- doxytag: member="listen.h::get_client_record" ref="fe0554ccbbd75254413e5e44b0afb851" args="(const struct sockaddr_in *addr, const struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structclient__record.html">client_record</a>* get_client_record           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the book-keeping record of a client that has not been disassociated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The client book-keeping record or NULL if the client has none. </dd></dl>

</div>
</div><p>
<a class="anchor" name="9535115f68e8eb3bb7bff4914dceedc1"></a><!-- doxytag: member="listen.h::get_empty_slot" ref="9535115f68e8eb3bb7bff4914dceedc1" args="(const struct sockaddr_in *client_addr, const struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structclient__record.html">client_record</a>* get_empty_slot           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a vacant slot in the DB to track a client.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The first empty slot in DB or NULL if the book-keeping DB is full. </dd></dl>

</div>
</div><p>
<a class="anchor" name="8b91cffd770899bbced999f3e5ca1618"></a><!-- doxytag: member="listen.h::listener_handle_packet" ref="8b91cffd770899bbced999f3e5ca1618" args="(const struct sockaddr_in *client_addr, const scream_packet_general *packet, size_t len, int sock, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> listener_handle_packet           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structscream__packet__general.html">scream_packet_general</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle a scream packet according to the state machine.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the address of the client who sent the packet. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>packet</em>&nbsp;</td><td>a valid <a class="el" href="structscream__packet__general.html">scream_packet_general</a>. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>len</em>&nbsp;</td><td>the length of the packet. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sock</em>&nbsp;</td><td>the UDP socket on which the packet was received. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the client book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="7596b6bd9e2d94203fe12fed9e9b4d31"></a><!-- doxytag: member="listen.h::mark_client_for_unregistering" ref="7596b6bd9e2d94203fe12fed9e9b4d31" args="(const struct sockaddr_in *client_addr, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> mark_client_for_unregistering           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set an absolute time after which the client slot in the book-keeping data structure can be reused.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="dd5eb83a8c3d1c6d9517d50213477866"></a><!-- doxytag: member="listen.h::record_packet" ref="dd5eb83a8c3d1c6d9517d50213477866" args="(const struct sockaddr_in *client_addr, const scream_packet_flood *packet, unsigned long long ts, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> record_packet           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long&nbsp;</td>
          <td class="paramname"> <em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process a <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>. If this is the first <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> from the client, the timestamp and the sequence number are simply recorded in the DB. If this is the subsequent <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>, the delta in the timestamp of the previous and current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> are recorded in the form of maximum and minimum latencies. The current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>'s timestamp is recorded as the previous timestamp. The current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>'s sequence number is only recorded if it is greater than the last recorded sequence number. The out-of-order flag is set if the current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>'s sequence number is less than the last recorded sequence number. Upon recording the sequence number of the current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>, the delta of the current and last recorded sequence number is calculated. If the delta is greater than 1, the total number as well as the maximum width of the gap that has been so far is updated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>packet</em>&nbsp;</td><td>the current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ts</em>&nbsp;</td><td>the timestamp of the current <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="ec133b4b155786027bc06e32e938fc42"></a><!-- doxytag: member="listen.h::register_client" ref="ec133b4b155786027bc06e32e938fc42" args="(const struct sockaddr_in *client_addr, const scream_packet_register *packet, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> register_client           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structscream__packet__register.html">scream_packet_register</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process a <a class="el" href="structscream__packet__register.html">scream_packet_register</a>. If the client is not already registered, a new record is created. If the new record cannot be created because the DB is full, the <a class="el" href="structscream__packet__register.html">scream_packet_register</a> will be ignored. If the new record can be created, the sleep time and the number of <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> to be sent are recorded. If the client is already registered, an <a class="el" href="scream-common_8h.html#7cc743b2e855728376994cf597f4e033">scream_packet_ack</a> will be sent.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the address of the client. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>packet</em>&nbsp;</td><td>the <a class="el" href="structscream__packet__register.html">scream_packet_register</a> containing the client's sleep time, the number of <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a> to be sent and the client's ID. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping structure to track the client.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="a4b3466b7f80ac38d6a1203aa482cdf2"></a><!-- doxytag: member="listen.h::reset_client" ref="a4b3466b7f80ac38d6a1203aa482cdf2" args="(int sock, const struct sockaddr_in *client_addr, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> reset_client           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process a <a class="el" href="scream-common_8h.html#471042ee689451a99118086cbfe07eb1">scream_packet_type::scream_packet_reset</a>. After determining whether or not there are some missing/out-of-order packets at the end, the flooding data of the client is sent to the client and the corresponding book-keeping entry is marked to be disassociated within <a class="el" href="listen_8h.html#766b55be6dacc759548a399b69d94e7a">TIME_TO_DEATH</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sock</em>&nbsp;</td><td>the socket through which the <a class="el" href="structscream__packet__result.html">scream_packet_result</a> is sent. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the address of the client. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping structure to track the client.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="3f5926de726bb2ac22b4535e7e516061"></a><!-- doxytag: member="listen.h::send_result" ref="3f5926de726bb2ac22b4535e7e516061" args="(int sock, const struct sockaddr_in *client_addr, const struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> send_result           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send <a class="el" href="structscream__packet__result.html">scream_packet_result</a> to the client who sent <a class="el" href="scream-common_8h.html#471042ee689451a99118086cbfe07eb1">scream_packet_reset</a>. The <a class="el" href="structscream__packet__result.html">scream_packet_result</a> contains the number of received <a class="el" href="structscream__packet__flood.html">scream_packet_flood</a>, the maximum width of the gap, the number of gaps, out-of-order flag, minimum latency, maximum latency, and average latency.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sock</em>&nbsp;</td><td>the socket through which the <a class="el" href="structscream__packet__result.html">scream_packet_result</a> is sent. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="bee273c1a34fbc88f25d136ecd32efbe"></a><!-- doxytag: member="listen.h::send_return_routability_ack" ref="bee273c1a34fbc88f25d136ecd32efbe" args="(int sock, const struct sockaddr_in *dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> send_return_routability_ack           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a <a class="el" href="scream-common_8h.html#61f295a7919e518232e95ca66fb2dce9">scream_packet_return_routability_ack</a> to the destination.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sock</em>&nbsp;</td><td>the socket through which the packet is to be sent. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dest</em>&nbsp;</td><td>the destination of the packet.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="8c8b9471866ddf0ca122010265b71426"></a><!-- doxytag: member="listen.h::send_update_address_ack" ref="8c8b9471866ddf0ca122010265b71426" args="(int sock, const struct sockaddr_in *dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> send_update_address_ack           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a <a class="el" href="scream-common_8h.html#da060a2cc64bea57f908de7d62d35653">scream_packet_update_address_ack</a> to the destination.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sock</em>&nbsp;</td><td>the socket through which the packet is to be sent. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dest</em>&nbsp;</td><td>the destination of the packet.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="31ace544a99797205c9b246b73546cd8"></a><!-- doxytag: member="listen.h::unregister_client" ref="31ace544a99797205c9b246b73546cd8" args="(const struct sockaddr_in *client_addr, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> unregister_client           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disassociate a client upon receiving a <a class="el" href="scream-common_8h.html#7cc743b2e855728376994cf597f4e033">scream_packet_ack</a> from the client.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the client address. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping data structure.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
<a class="anchor" name="5596da7ea67727af7317a7567d277d1f"></a><!-- doxytag: member="listen.h::update_client_address" ref="5596da7ea67727af7317a7567d277d1f" args="(const struct sockaddr_in *client_addr, const scream_packet_update_address *packet, struct client_db *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="scream-common_8h.html#08b18ac8af0f3462354240d9732f3852">err_code</a> update_client_address           </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>client_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structscream__packet__update__address.html">scream_packet_update_address</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structclient__db.html">client_db</a> *&nbsp;</td>
          <td class="paramname"> <em>db</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update a client address.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>client_addr</em>&nbsp;</td><td>the address of the client. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>packet</em>&nbsp;</td><td>the <a class="el" href="structscream__packet__update__address.html">scream_packet_update_address</a> containing the client's ID, the new IPv4 address and the new port. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>db</em>&nbsp;</td><td>the book-keeping structure to track the client.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>An error code. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 25 04:18:49 2009 for screamer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
